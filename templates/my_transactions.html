{% load static %}
{% static "images" as baseUrl %}

<!doctype html>
<html lang="en">
{% include 'header.html' %}
<body>
    {% include 'atm_sidebar.html' %}
    <div class="content-container">
        <h2 class="ml-4 text-primary">Your Loans</h2>
        <br>
        {% include 'messages.html' %}
        {% if authConfirmation %}
        {% include 'a_sessiontimeout.html' %}
        <!-- <h5 class="ml-5">Information for account ending in {{ debit_last_four }}</h5> -->
        <h2 class="ml-4 text-primary">Money Deposited</h2>
        <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th scope="col" style="text-align: center;">ID</th>
                <th scope="col" style="text-align: center;">Type</th>
                <th scope="col" style="text-align: center;">Symbol</th>
                <th scope="col" style="text-align: center;">Currency</th>
                <th scope="col" style="text-align: center;">Amount</th>
                <th scope="col" style="text-align: center;">State</th>
                <th scope="col" style="text-align: center;">Date</th>
            </tr>
            </thead>
            <tbody>
                {% for transaction in deposit_transactions %}
                    <tr>
                        <th scope="row" style="text-align: center;">{{ transaction.id_a }} </th>
                        <td style="text-align: center;">{{ transaction.transaction_type }} </td>
                        <td style="text-align: center;">{{ transaction.currency_name.symbol }} </td>
                        <td style="text-align: center;">{{ transaction.currency_name.currency_name }} </td>
                        <td style="text-align: center;">{{ transaction.amount }} </td>
                        <td style="text-align: center;">{{ transaction.state }} </td>
                        <td style="text-align: center;">{{ transaction.creation_datetime }} </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <h2 class="ml-4 text-primary">Money Sent</h2>
        <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th scope="col" style="text-align: center;">ID</th>
                <th scope="col" style="text-align: center;">Type</th>
                <th scope="col" style="text-align: center;">Symbol</th>
                <th scope="col" style="text-align: center;">Currency</th>
                <th scope="col" style="text-align: center;">Amount</th>
                <th scope="col" style="text-align: center;">State</th>
                <th scope="col" style="text-align: center;">Date</th>
            </tr>
            </thead>
            <tbody>
                {% for transaction in withdrawal_transactions %}
                    <tr>
                        <th scope="row" style="text-align: center;">{{ transaction.id_a }} </th>
                        <td style="text-align: center;">{{ transaction.transaction_type }} </td>
                        <td style="text-align: center;">{{ transaction.currency_name.symbol }} </td>
                        <td style="text-align: center;">{{ transaction.currency_name.currency_name }} </td>
                        <td style="text-align: center;">{{ transaction.amount }} </td>
                        <td style="text-align: center;">{{ transaction.state }} </td>
                        <td style="text-align: center;">{{ transaction.creation_datetime }} </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <h2 class="ml-4 text-primary">Credit Lines</h2>
        <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th scope="col" style="text-align: center;">ID</th>
                <th scope="col" style="text-align: center;">BLOCKCHAIN</th>
                <th scope="col" style="text-align: center;">CREDIT RAITING</th>
                <th scope="col" style="text-align: center;">TIME OF USE</th>
                <th scope="col" style="text-align: center;">AVAILABLE</th>
                <th scope="col" style="text-align: center;">PRICE</th>
            </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="text-align: center;">1</td>
                    <td style="text-align: center;">Litecoin</td>
                    <td style="text-align: center;">F</td>
                    <td style="text-align: center;">30 days</td>
                    <td style="text-align: center;">May. 12, 2022</td>
                    <td style="text-align: center;">100</td>
                </tr>
            </tbody>
        </table>

        {% else %}
        <h5 class="ml-5">You are not currently signed in. To sign in or make an account, <a href="{% url 'authentication:Home' %}">click or tap here.</a></h5>
        {% endif %}
    </div>
    
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                autoDisplay: false
            }, 'google_translate_element'); //remove the layout
        }
    </script>
    <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" type="text/javascript">
    </script>
    
    
    <script type="text/javascript">
        function triggerHtmlEvent(element, eventName) {
            var event;
            if (document.createEvent) {
                event = document.createEvent('HTMLEvents');
                event.initEvent(eventName, true, true);
                element.dispatchEvent(event);
            } else {
                event = document.createEventObject();
                event.eventType = eventName;
                element.fireEvent('on' + event.eventType, event);
            }
        }
        
        $('.translation-links a').click(function (e) {
            e.preventDefault();
            var lang = $(this).data('lang');
            $('#google_translate_element select option').each(function () {
                if ($(this).text().indexOf(lang) > -1) {
                    $(this).parent().val($(this).val());
                    var container = document.getElementById('google_translate_element');
                    var select = container.getElementsByTagName('select')[0];
                    triggerHtmlEvent(select, 'change');
                }
            });
        });
    </script>
    
    <script type="text/javascript">
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != "") {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                    }
                }
            }
            return cookieValue;
        }

        function RemoveOfferModal(offerID, offerType, offerAmount){
            document.getElementById("cancel_id").innerHTML = "ID : "+ offerID;
            document.getElementById("cancel_type").innerHTML = "Type : "+ offerType;
            document.getElementById("cancel_amount").innerHTML = "Amount : "+ offerAmount;
            document.getElementById("delete_offer").id = offerID;
        }

        function PayLoanModal(offerID, offerType, offerAmount){
            document.getElementById("pay_id").innerHTML = "ID : "+ offerID;
            document.getElementById("pay_type").innerHTML = "Type : "+ offerType;
            document.getElementById("pay_amount").innerHTML = "Amount : "+ offerAmount;
            document.getElementById("pay_loan").id = offerID;
        }

        function RemoveOffer(offerID){
            var url = "{% url 'atm_functions:RemoveOffer' %}";
            var data = {
                offerID: offerID,
                csrfmiddlewaretoken: getCookie('csrftoken')
            };
            $.ajax({
                type: "POST",
                url: url,
                data: data,
                success: function(response){
                    document.getElementById(offerID).id = "delete_offer";
                    $("#transaction_b_"+offerID).remove();
                    $("#RemoveModal").modal('hide');
                    $("#RemoveModal").modal('hide');
                },
                error: function(response){
                    document.getElementById(offerID).id = "delete_offer";
                    alert("Something went wrong, please try again later");
                    $("#RemoveModal").modal('hide');
                }
            });
        };
        
        function PayOffer(offerID){
            var url = "{% url 'atm_functions:PayOffer' %}";
            var data = {
                offerID: offerID,
                csrfmiddlewaretoken: getCookie('csrftoken')
            };
            $.ajax({
                type: "POST",
                url: url,
                data: data,
                success: function(response){
                    document.getElementById(offerID).id = "pay_loan";
                    $("#transaction_b_"+offerID).remove();
                    $("#PayModal").modal('hide');
                    $("#PayModal").modal('hide');
                },
                error: function(response){
                    document.getElementById(offerID).id = "pay_loan";
                    alert("Something went wrong, please try again later");
                    $("#PayModal").modal('hide');
                }
            });
        };

    </script>
    <!-- <div class="row">
        <div class="col-5 d-flex justify-content-center text-center">
            <div class="card container1">
                <h2 class="text-primary">HAVE FUN USING CRYPTOSHARE!!!</h2>
                <br>
                <button type="submit" class="btn btn-primary btn-lg btn-block">Create Account</button>
                <button type="submit" class="btn btn-secondary btn-lg btn-block">Login to Account</button>
            </div>
        </div>
        <div class="col-xl-7 d-flex justify-content-center text-center">
            <div class="card container1">
                <h2 class="text-primary">CREATED BY :</h2>
                
                <h5>Anade Davis - Data Science Manager </h5>
                <h5>Shailee R. Desai - (Project Lead) Data Analyst </h5>
                <h5>Alexander Rodriguez - (Project Lead) Data Analyst </h5>
                <h5>William Munson - Data Scientist</h5>
                <h5>Harleen Bagga - Data Scientist</h5>
            </div>
        </div>
    </div> -->
</body>
</html>

<!-- Modal -->
<div id="RemoveModal" class="modal" style="z-index: 2000;">
    <!-- Modal content -->
    <div class="modal-content">
        <div class="modal-header">
            <h3>CANCEL CONFIRMATION</h3>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <p style="color: black;font-weight: 400; text-align: center;">Are you sure you want to cancel the following offer?</p>
            <ul style="list-style: none; margin: 0; padding: 0;">
                <li id="cancel_id" style="text-align: center;"></li>
                <li id="cancel_type" style="text-align: center;"></li>
                <li id="cancel_amount" style="text-align: center;"></li>
            </ul>
            <br>
            <div class="d-flex justify-content-center">
                <button style="text-align: center;" class="btn btn-danger" data-toggle="modal" onclick="RemoveOffer(this.id)" id="delete_offer">Delete Offer</button> 
            </div>
        </div>
    </div>
    
</div>

<div id="PayModal" class="modal" style="z-index: 2000;">
    <!-- Modal content -->
    <div class="modal-content">
        <div class="modal-header">
            <h3>PAYMENT CONFIRMATION</h3>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <p style="color: black;font-weight: 400; text-align: center;">Are you sure you want to pay the following offer?</p>
            <ul style="list-style: none; margin: 0; padding: 0;">
                <li id="pay_id" style="text-align: center;"></li>
                <li id="pay_type" style="text-align: center;"></li>
                <li id="pay_amount" style="text-align: center;"></li>
            </ul>
            <br>
            <div class="d-flex justify-content-center">
                <button style="text-align: center;" class="btn btn-success" data-toggle="modal" onclick="PayOffer(this.id)" id="pay_loan">Pay Loan</button> 
            </div>
        </div>
    </div>
    
</div>